{"version":3,"file":"shtcut-provider.js","names":["deepMerge","isString","omit","toRGB","walkObject","createContext","useContext","useMemo","defaultTheme","isBrowser","set","toCSSVar","Global","ShtcutContext","undefined","displayName","ShtcutProvider","_ref","theme","colorScheme","density","cssVarsRoot","children","computedTheme","_theme$colorSchemes$c","omittedTheme","colors","type","colorSchemes","document","documentElement","classList","add","remove","value","path","rgb","join","normalizedTheme","_extends","React","createElement","Provider","styles","__cssVars","useShtcut","Error","extendTheme","themeOverride","clone"],"sources":["../../src/shtcut-provider.tsx"],"sourcesContent":["import { Dict, WithCSSVar, deepMerge, isString, omit, toRGB, walkObject } from '@shtcut-ui/utils';\nimport { Context, ReactNode, createContext, useContext, useMemo } from 'react';\nimport { ShtcutThemeOverride, ShtcutUiTheme } from './types';\nimport { defaultTheme } from './default-theme';\nimport { isBrowser } from './utils';\nimport set from 'lodash.set';\nimport { toCSSVar } from './to-css-var';\nimport { Global } from '@emotion/react';\n\ninterface DictShtcutTheme extends Dict {}\n\nexport const ShtcutContext = createContext<{ theme: WithCSSVar<DictShtcutTheme> } | undefined>(undefined);\n\nShtcutContext.displayName = 'ShtcutContext';\n\nexport interface ShtcutProviderProps {\n  children: ReactNode;\n  theme?: ShtcutUiTheme;\n  density?: 'compact' | 'comfortable' | 'unset';\n  colorScheme?: string;\n  cssVarsRoot?: string;\n}\n\nexport function ShtcutProvider({\n  theme = defaultTheme,\n  colorScheme = 'light',\n  density = 'comfortable',\n  cssVarsRoot = ':host, :root',\n  children,\n}: ShtcutProviderProps) {\n  const computedTheme = useMemo(() => {\n    const omittedTheme = omit(theme, ['colorSchemes', 'density']);\n    const { colors, type } = theme.colorSchemes[colorScheme] ?? {};\n    if (isBrowser) {\n      if (type === 'dark') document.documentElement.classList.add('dark');\n      else document.documentElement.classList.remove('dark');\n    }\n    walkObject(colors, (value, path) => {\n      if (!isString(value)) return;\n      const rgb = toRGB(value);\n      if (rgb) set(colors, path, rgb.join(','));\n    });\n    const normalizedTheme = {\n      ...omittedTheme,\n      density: theme.density[density],\n      colors,\n    };\n    return toCSSVar(normalizedTheme);\n  }, [theme, colorScheme, density]);\n\n  const value = useMemo(\n    () => ({\n      theme: computedTheme,\n    }),\n    [computedTheme],\n  );\n  return (\n    <ShtcutContext.Provider value={value}>\n      <Global styles={() => ({ [cssVarsRoot]: computedTheme.__cssVars })} />\n      {children}\n    </ShtcutContext.Provider>\n  );\n}\n\nexport function useShtcut<T extends object = Dict>() {\n  const theme = useContext(ShtcutContext as unknown as Context<T | undefined>);\n  if (!theme) {\n    throw Error('useShtcut: `theme` is defined. Maybe you have not to wrap your app in <ShtcutProvider />');\n  }\n  return theme as WithCSSVar<T>;\n}\n\nexport function extendTheme(themeOverride: ShtcutThemeOverride): ShtcutUiTheme {\n  return deepMerge(defaultTheme, themeOverride, { clone: true }) as ShtcutUiTheme;\n}\n"],"mappings":"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"}